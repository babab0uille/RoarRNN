import os
from pydub import AudioSegment

# List of audio files
audio_files = [
    "D:/Elephants Documentation/Audios/Clearing/audio1.wav"
    # "D:/Elephants Documentation/Audios/Clearings/audio2.wav",
]

# List of special markings with (start_time, end_time) tuples in seconds
special_markings = [
    # beginning of audio1 markings
    (3438.983, 3444.672), 
    (6024.554, 6026.254), 
    (7203.532, 7207.153), 
    (12601.648, 12605.01), 
    (30796.84, 30799.093), 
    (30805.411, 30809.438), 
    (31051.747, 31058.287), 
    (31107.927, 31112.693), 
    (31207.245, 31210.459), 
    (31236.875, 31243.378), 
    (31273.88, 31278.757), 
    (31289.054, 31294.492), 
    (31315.433, 31322.194), 
    (31345.197, 31348.784), 
    (31376.885, 31381.541), 
    (31399.57, 31405.629), 
    (31445.438, 31450.094), 
    (31480.969, 31485.033), 
    (31499.22, 31505.612), 
    (31599.938, 31605.373), 
    (32183.154, 32187.255), 
    (32240.331, 32243.952), 
    (32281.818, 32285.032), 
    (32322.816, 32324.919), 
    (32518.718, 32521.193), 
    (32529.654, 32536.855), 
    (32605.485, 32609.882), 
    (32788.201, 32791.563), 
    (33064.408, 33069.765), 
    (33142.925, 33149.686), 
    (33166.718, 33170.708), 
    (33219.403, 33224.871), 
    (33245.457, 33251.627), 
    (33271.895, 33276.92), 
    (33313.001, 33318.913), 
    (33342.754, 33346.855), 
    (33370.43, 33376.785), 
    (33429.122, 33434.848), 
    (33483.732, 33487.906), 
    (33520.349, 33526.666), 
    (33561.344, 33565.925), 
    (33603.876, 33608.309), 
    (33641.154, 33646.474), 
    (33725.176, 33731.024), 
    (33885.107, 33891.757), 
    (34014.868, 34018.156), 
    (34183.223, 34187.509), 
    (34258.452, 34262.664), 
    (34334.815, 34338.768), 
    (34368.24, 34371.196), 
    (34414.699, 34417.101), 
    (34425.303, 34427.298), 
    (34453.415, 34459.216), 
    (34573.666, 34581.721), 
    (34670.782, 34676.435), 
    (34895.006, 34901.472), 
    (35177.272, 35181.595), 
    (35220.263, 35226.691), 
    (35267.893, 35274.174), 
    (35358.787, 35363.701), 
    (35417.771, 35420.098), 
    (36244.142, 36248.649), 
    (69143.494, 69149.294), 
    (69977.752, 69983.11), 
    (70168.607, 70175.035), 
    (70282.001, 70286.176), 
    (70400.479, 70405.947), 
    (70681.747, 70687.474), 
    (71360.708, 71364.846), 
    (71829.454, 71832.632), 
    (71831.671, 71835.033), 
    (71834.926, 71836.441), 
    (71861.102, 71863.873), 
    (71863.171, 71867.087), 
    (71879.908, 71882.161), 
    (71882.42, 71886.779), 
    (71896.459, 71900.708), 
    (71899.378, 71903.146), 
    (71932.614, 71936.161), 
    (71934.536, 71936.789), 
    (71961.432, 71964.979), 
    (71965.053, 71966.45693), 
    (71985.831, 71991.041), 
    (72068.405, 72071.767), 
    (72118.045, 72119.41199), 
    (72119.412, 72121.629), 
    (72154.164, 72157.267), 
    (72156.935, 72159.595), 
    (72175.777, 72179.693), 
    (72195.092, 72199.858), 
    (72198.38, 72202.038), 
    (72217.208, 72221.494), 
    (72319.777, 72322.88), 
    (72626.76, 72629.863), 
    (72629.682, 72631.455), 
    (73168.459, 73171.378), 
    (73642.156, 73650.58), 
    (73775.01, 73780.699), 
    (73792.371, 73796.952), 
    (73804.6, 73808.442), 
    (73807.666, 73812.358), 
    (73824.92, 73830.166), 
    (73860.669, 73865.065), 
    (73940.738, 73947.203), 
    (73951.6, 73958.102), 
    (74024.701, 74030.169), 
    (74034.935, 74042.25), 
    (74103.07, 74109.277), 
    (74506.563, 74515.577), 
    (74523.214, 74524.951), 
    (74525.102, 74528.058), 
    (74529.351, 74534.856), 
    (74536.038, 74541.617), 
    (74576.072, 74580.838), 
    (74583.499, 74587.156), 
    (74587.673, 74591.22), 
    (74591.571, 74594.379), 
    (74593.659, 74598.203), 
    (74637.646, 74640.639), 
    (74638.533, 74642.302), 
    (74653.814, 74657.878), 
    (74678.087, 74684.036), 
    (74725.585, 74731.644), 
    (74819.804, 74825.826), 
    (74879.198, 74885.294), 
    (75043.6, 75048.255), 
    (75157.917, 75163.903), 
    (75264.218, 75268.577), 
    (75273.159, 75282.026), 
    (75289.522, 75292.699), 
    (75311.383, 75316.075), 
    (75436.932, 75443.361), 
    (75467.301, 75468.81578), 
    (75581.863, 75588.033), 
    (75588.809, 75593.649), 
    (75594.776, 75596.51245), 
    (75599.634, 75605.804), 
    (75609.683, 75612.713), 
    (75615.151, 75622.171), 
    (75628.252, 75634.903), 
    (75653.302, 75657.107), 
    (75805.807, 75812.974), 
    (76738.474, 76744.459), 
    (77003.782, 77008.178), 
    (77699.981, 77707.075), 
    (78598.622, 78603.203), 
    (78617.169, 78624.779), 
    (78796.385, 78802.703), 
    (79037.161, 79043.294), 
    (79369.142, 79373.242), 
    (79785.957, 79790.649), 
    (79799.073, 79807.496), 
    (79970.937, 79977.55), 
    (80122.371, 80125.142), 
    (80172.281, 80173.98), 
    (80202.75, 80205.484), 
    (80473.821, 80479.848),
    (80486.659, 80491.35),
    (80506.932, 80510.368),
    (80560.382, 80564.978),
    (80594.405, 80598.905),
    (80610.54, 80615.199),
    (80744.761, 80749.198),
    (80751.175, 80753.503),
    (80753.603, 80756.076),
    (80771.554, 80775.972),
    (80783.821, 80786.393),
    (80792.34, 80796.101),
    (80803.243, 80808.451),
    (80831.989, 80836.628),
    (80870.003, 80873.293),
    (80933.767, 80937.209),
    (80974.948, 80977.485),
    (80999.936, 81003.154),
    (81037.171, 81041.496),
    (81047.761, 81050.665),
    (81086.329, 81091.203),
    (81100.802, 81105.197),
    (81124.865, 81128.483),
    (81131.146, 81135.719),
    (81151.765, 81156.176),
    (81218.12, 81222.108),
    (81222.258, 81225.17),
    (81275.755, 81278.634),
    (81286.024, 81288.899),
    (81329.882, 81333.605),
    (81333.734, 81335.429),
    (81356.508, 81360.149),
    (81362.314, 81365.938),
    (81366.057, 81367.628),
    (81447.093, 81449.791),
    (81461.317, 81463.596),
    (81469.469, 81472.823),
    (81503.229, 81506.823),
    (81531.137, 81534.199),
    (81541.646, 81545.263),
    (81578.78, 81582.053),
    (81587.131, 81590.085),
    (81609.47, 81614.209),
    (81614.346, 81617.185),
    (81623.969, 81628.219),
    (81635.994, 81638.198),
    (81639.85, 81643.394),
    (81663.93, 81666.575),
    (81673.914, 81678.676),
    (81694.896, 81697.789),
    (81736.099, 81739.458),
    (81764.979, 81767.727),
    (81781.213, 81784.367),
    (81784.588, 81786.199),
    (81811.91, 81815.198),
    (81839.865, 81844.443),
    (81854.178, 81856.729),
    (81872.824, 81876.319),
    (81890.898, 81894.073),
    (81894.198, 81897.149),
    (81904.92, 81909.282),
    (81927.808, 81930.771),
    (81947.749, 81951.222),
    (81974.352, 81977.728),
    (82025.08, 82028.21),
    (82031.872, 82034.399),
    (82061.35, 82064.051),
    (82090.146, 82093.643),
    (82094.703, 82096.299),
    (82111.877, 82114.747),
    (82125.476, 82128.202),
    (82161.104, 82164.263),
    (82191.932, 82195.234),
    (82211.827, 82215.14),
    (82220.221, 82223.059),
    (82241.726, 82244.493),
    (82251.614, 82254.341),
    (82277.804, 82282.198),
    (82306.448, 82309.728),
    (82312.946, 82315.595),
    (82332.405, 82335.549),
    (82357.62, 82360.647),
    (82367.798, 82370.303),
    (82395.019, 82397.895),
    (82404.003, 82408.14),
    (82432.355, 82435.61),
    (82451.907, 82455.539),
    (82463.778, 82467.353),
    (82486.122, 82489.943),
    (82502.713, 82506.283),
    (82535.902, 82539.422),
    (82564.378, 82567.813),
    (82594.226, 82598.162),
    (82621.604, 82624.86),
    (82656.01, 82658.693),
    (82674.893, 82677.559),
    (82688.696, 82692.228),
    (82701.795, 82705.523),
    (82718.364, 82721.396),
    (82734.36, 82738.268),
    (82752.512, 82755.613),
    (82756.914, 82758.579),
    (82762.671, 82764.618),
    (82786.273, 82788.988),
    (82789.149, 82792.388),
    (82798.69, 82800.582),
    (82809.087, 82813.159),
    (82813.29, 82814.811),
    (82833.671, 82837.189),
    (82855.173, 82858.672),
    (82865.573, 82868.461),
    (82882.417, 82886.517),
    (82919.893, 82923.156),
    (82925.091, 82929.601),
    (82933.248, 82936.302),
    (82940.99, 82944.698),
    (82958.688, 82961.296),
    (82969.001, 82972.001),
    (82994.932, 82997.552),
    (83010.528, 83014.254),
    (83020.688, 83023.54),
    (83035.292, 83039.012),
    (83063.893, 83067.173),
    (83068.71, 83072.82),
    (83083.264, 83086.48),
    (83107.608, 83110.719),
    (83135.094, 83138.6),
    (83153.702, 83156.915),
    (83182.608, 83186.213),
    (83198.153, 83201.664),
    (83220.155, 83224.393),
    (83225.338, 83227.214),
    (83233.933, 83236.762),
    (83247.097, 83250.847),
    (83257.234, 83260.2),
    (83266.866, 83270.17),
    (83291.428, 83295.369),
    (83304.228, 83306.968),
    (83328.037, 83331.455),
    (83351.515, 83355.75),
    (83380.465, 83383.726),
    (83396.726, 83400.24),
    (83403.902, 83405.619),
    (83423.876, 83427.16),
    (83440.249, 83444.072),
    (83452.453, 83455.167),
    (83463.916, 83467.445),
    (83475.913, 83480.199),
    (83488.255, 83490.83),
    (83505.022, 83509.619),
    (83520.706, 83524.449),
    (83527.05, 83531.232),
    (83535.844, 83540.109),
    (83556.798, 83560.247),
    (83579.444, 83582.433),
    (83591.661, 83594.579),
    (83603.442, 83606.424),
    (83609.462, 83614.652),
    (83623.74, 83626.707),
    (83635.688, 83639.657),
    (83640.926, 83644.684),
    (83647.66, 83651.497),
    (83656.195, 83658.72),
    (83671.81, 83674.739),
    (83677.902, 83680.876),
    (83684.524, 83687.772),
    (83693.526, 83695.745),
    (83704.661, 83708.98),
    (83711.034, 83713.706),
    (83721.818, 83725.353),
    (83725.908, 83730.602),
    (83741.338, 83744.228),
    (83753.474, 83756.747),
    (83762.892, 83766.317),
    (83779.858, 83783.486),
    (83791.611, 83795.153),
    (83807.777, 83811.686),
    (83828.057, 83831.713),
    (83841.666, 83845.418),
    (83846.779, 83850.718),
    (83862.218, 83865.849),
    (83867.793, 83870.812),
    (83877.208, 83880.524),
    (83895.826, 83899.332),
    (83906.867, 83909.403),
    (83924.535, 83928.014),
    (83936.914, 83939.713),
    (83951.548, 83955.262),
    (83957.793, 83960.627),
    (83974.27, 83977.908),
    (83989.454, 83993.317),
    (83999.635, 84003.317),
    (84011.936, 84015.564),
    (84020.34, 84024.054),
    (84035.43, 84039.054),
    (84045.231, 84048.204),
    (84050.444, 84053.568),
    (84066.912, 84069.74),
    (84079.033, 84082.699),
    (84088.639, 84092.375),
    (84104.672, 84107.417),
    (84113.524, 84117.299),
    (84122.728, 84126.377),
    (84128.739, 84131.501),
    (84141.988, 84145.438),
    (84155.338, 84159.099),
    (84164.862, 84167.88),
    (84183.518, 84186.79),
    (84189.839, 84194.011),
    (84209.015, 84213.198),
    (84223.692, 84227.002),
    (84240.174, 84244.37),
    (84256.893, 84260.775),
    (84271.017, 84275.51),
    (84280.264, 84283.04),
    (84291.194, 84295.239),
    (84302.876, 84306.398),
    (84321.659, 84325.191),
    (84328.092, 84331.557),
    (84336.524, 84340.139),
    (84343.478, 84347.133),
    (84349.936, 84352.536),
    (84365.489, 84369.062),
    (84377.647, 84380.859),
    (84391.029, 84395.146),
    (84404.227, 84408.038),
    (84423.684, 84427.105),
    (84434.057, 84437.577),
    (84440.583, 84443.415),
    (84459.875, 84463.433),
    (84470.983, 84474.438),
    (84479.759, 84482.814),
    (84494.872, 84497.541),
    (84506.936, 84510.503),
    (84516.487, 84519.139),
    (84531.528, 84534.558),
    (84546.455, 84550.099),
    (84555.047, 84558.18),
    (84566.982, 84569.438),
    (84581.667, 84585.42),
    (84593.179, 84597.444),
    (84606.458, 84609.58),
    (84615.733, 84619.155),
    (84621.29, 84623.938),
    (84632.889, 84636.323),
    (84648.007, 84651.172),
    (84659.536, 84663.24),
    (84670.835, 84674.536),
    (84681.913, 84685.711),
    (84691.924, 84694.612),
    (84699.836, 84702.812),
    (84711.755, 84715.634),
    (84725.484, 84728.451),
    (84738.58, 84742.201),
    (84748.214, 84751.351),
    (84757.937, 84760.672),
    (84767.668, 84771.601),
    (84779.585, 84783.19),
    (84791.139, 84794.658),
    (84799.674, 84802.657),
    (84810.434, 84813.467),
    (84820.842, 84823.681),
    (84832.294, 84836.29),
    (84844.754, 84848.246),
    (84859.923, 84863.38),
    (84872.06, 84875.447),
    (84886.237, 84889.642),
    (84897.005, 84900.451),
    (84905.98, 84908.899),
    (84918.674, 84921.88),
    (84929.849, 84932.542),
    (84942.458, 84945.338),
    (84953.598, 84956.612),
    (84962.975, 84966.552),
    (84978.332, 84981.571),
    (84986.362, 84990.137),
    (84996.58, 84999.447),
    (85005.426, 85008.389),
    (85021.949, 85025.05),
    (85028.964, 85032.626),
    (85040.516, 85043.449),
    (85050.376, 85053.439),
    (85066.058, 85069.626),
    (85076.347, 85079.202),
    (85084.95, 85088.075),
    (85102.287, 85105.087),
    (85111.742, 85114.669),
    (85119.867, 85123.465),
    (85131.759, 85135.203),
    (85145.944, 85149.453),
    (85160.119, 85163.59),
    (85170.481, 85173.505),
    (85181.658, 85185.38),
    (85191.957, 85194.777),
    (85205.98, 85209.53),
    (85214.693, 85217.53),
    (85225.958, 85228.545),
    (85238.551, 85241.98),
    (85249.384, 85252.716),
    (85257.596, 85260.283),
    (85273.13, 85276.39),
    (85281.543, 85284.748),
    (85295.908, 85298.662),
    (85305.37, 85308.506),
    (85314.853, 85317.7),
    (85323.962, 85327.31),
    (85333.388, 85336.535),
    (85350.121, 85352.88),
    (85360.005, 85362.944),
    (85369.492, 85373.28),
    (85379.954, 85382.786),
    (85389.08, 85391.87),
    (85397.912, 85400.734),
    (85407.902, 85410.96),
    (85414.09, 85417.87),
    (85432.71, 85435.7),
    (85443.998, 85447.71),
    (85455.58, 85458.445),
    (85468.437, 85471.23),
    (85476.578, 85480.07),
    (85494.077, 85496.99),
    (85509.91, 85512.808),
    (85521.925, 85524.686),
    (85532.004, 85535.105),
    (85547.648, 85550.87),
    (85558.57, 85561.6),
    (85571.127, 85573.66),
    (85580.906, 85583.77),
    (85588.474, 85591.457),
    (85599.244, 85602.17),
    (85614.422, 85617.3),
    (85630.158, 85633.02),
    (85646.04, 85648.897),
    (85656.83, 85660.76),
    (85668.244, 85671.94),
    (85680.875, 85683.635),
    (85695.482, 85698.84),
    (85704.524, 85707.485),
    (85717.486, 85720.405),
    (85729.716, 85732.647),
    (85743.194, 85745.993),
    (85750.905, 85753.935),
    (85762.84, 85765.825),
    (85775.497, 85778.456),
    (85789.307, 85792.13),
    (85802.705, 85805.743),
    (85814.55, 85817.591),
    (85823.144, 85825.845),
    (85836.426, 85839.285),
    (85844.929, 85847.708),
    (85859.607, 85862.539),
    (85874.624, 85877.561),
    (85887.59, 85890.665),
    (85900.456, 85903.225),
    (85909.621, 85912.595),
    (85927.823, 85930.909),
    (85944.75, 85947.642),
    (85951.73, 85954.697),
    (85968.4, 85971.514),
    (85982.694, 85985.668),
    (86001.598, 86004.517),
    (86016.704, 86019.71),
    (86034.098, 86037.252),
    (86049.006, 86051.831),
    (86064.362, 86067.493),
    (86083.107, 86086.024),
    (86099.056, 86102.08),
    (86112.628, 86115.55),
    (86131.766, 86134.741),
    (86142.865, 86145.614),
    (86160.647, 86163.713),
    (86176.854, 86179.873),
    (86192.156, 86195.065),
    (86208.551, 86211.488),
    (86221.732, 86224.524),
    (86240.858, 86243.837),
    (86258.546, 86261.396),
    (86276.217, 86279.097),
    (86290.887, 86293.787),
    (86308.213, 86311.033),
    (86324.578, 86327.464),
    (86342.106, 86344.951),
    (86354.615, 86357.583),
    (86374.606, 86377.374),
    (86390.322, 86393.232),
    (86402.282, 86405.06),
    (86421.26, 86424.087),
    (86438.61, 86441.558),
    (86455.425, 86458.441),
    (86469.98, 86472.866),
    (86487.451, 86490.397),
    (86503.657, 86506.552),
    (86520.014, 86522.986),
    (86534.875, 86537.683),
    (86553.289, 86556.098),
    (86569.539, 86572.326),
    (86587.062, 86589.967),
    (86603.164, 86606.089),
    (86621.482, 86624.278),
    (86636.624, 86639.587),
    (86652.914, 86655.668),
    (86671.79, 86674.64),
    (86685.543, 86688.512),
    (86705.205, 86708.162),
    (86724.56, 86727.352),
    (86742.497, 86745.385),
    (86757.354, 86760.286),
    (86771.065, 86774.034),
    (86789.103, 86791.976),
    (86804.77, 86807.697),
    (86820.462, 86823.35),
    (86836.854, 86839.862),
    (86852.879, 86855.775),
    (86869.078, 86871.926),
    (86883.537, 86886.601),
    (86902.342, 86905.221),
    (86917.99, 86920.987),
    (86935.898, 86938.691),
    (86951.933, 86954.855),
    (86967.567, 86970.572),
    (86982.298, 86985.289),
    (86998.084, 87000.979),
    (87012.09, 87014.94),
    (87027.793, 87030.697),
    (87042.637, 87045.524),
    (87057.83, 87060.612),
    (87073.365, 87076.298),
    (87088.197, 87091.068),
    (87104.093, 87107.085),
    (87118.509, 87121.406),
    (87134.15, 87137.075),
    (87150.544, 87153.474),
    (87166.914, 87169.8),
    (87182.425, 87185.271),
    (87198.32, 87201.165),
    (87215.212, 87218.116),
    (87230.053, 87232.924),
    (87244.806, 87247.689),
    (87261.315, 87264.198),
    (87277.676, 87280.642),
    (87293.695, 87296.672),
    (87309.548, 87312.558),
    (87325.646, 87328.463),
    (87340.382, 87343.335),
    (87356.705, 87359.59),
    (87372.52, 87375.468),
    (87388.986, 87391.808),
    (87404.442, 87407.456),
    (87420.073, 87423.056),
    (87436.052, 87439.087),
    (87450.967, 87453.788),
    (87466.644, 87469.552),
    (87483.192, 87486.031),
    (87498.891, 87501.703),
    (87514.779, 87517.647),
    (87531.683, 87534.47),
    (87547.797, 87550.63),
    (87563.243, 87566.13),
    (87579.86, 87582.806),
    (87594.984, 87597.77),
    (87611.798, 87614.588),
    (87627.266, 87630.171),
    (87642.976, 87645.838),
    (87658.836, 87661.795),
    (87675.132, 87677.913),
    (87691.064, 87693.97),
    (87706.98, 87709.863),
    (87722.44, 87725.396),
    (87738.758, 87741.647),
    (87754.29, 87757.154),
    (87770.058, 87772.94),
    (87786.395, 87789.191),
    (87802.323, 87805.139),
    (87817.977, 87820.776),
    (87833.571, 87836.405),
    (87848.68, 87851.526),
    (87864.641, 87867.417),
    (87880.531, 87883.453),
    (87895.703, 87898.592),
    (87911.529, 87914.317),
    (87927.618, 87930.497),
    (87943.072, 87945.956),
    (87958.425, 87961.204),
    (87973.541, 87976.437),
    (87989.258, 87992.014),
    (88005.253, 88008.042),
    (88020.588, 88023.383),
    (88035.845, 88038.643),
    (88052.3, 88055.065),
    (88068.377, 88071.149),
    (88083.915, 88086.75),
    (88098.417, 88101.269),
    (88113.843, 88116.662),
    (88128.941, 88131.738),
    (88144.287, 88147.16),
    (88160.172, 88162.947),
    (88175.765, 88178.599),
    (88191.542, 88194.322),
    (88207.409, 88210.149),
    (88223.423, 88226.251),
    (88239.09, 88241.936),
    (88254.463, 88257.325),
    (88270.648, 88273.397),
    (88285.835, 88288.799),
    (88301.32, 88304.227),
    (88316.844, 88319.758),
    (88331.605, 88334.536)
    # end of audio1 markings
]  

# Output directory for the extracted clips
output_dir = "D:/Elephants Documentation/Output_Audios/ClearingOutput/FinalWaveForms"

os.makedirs(output_dir, exist_ok=True)

def extend_window(start_time, end_time, window_duration=2):
    center_time = (start_time + end_time) / 2
    new_start_time = max(center_time - window_duration / 2, 0)  # non-negative
    new_end_time = center_time + window_duration / 2
    return new_start_time, new_end_time

def extract_clips(audio_files, special_markings, output_dir):
    current_position = 0  # keep track of the overall position in the combined audio
    clip_counter = 1

    for file in audio_files:
        audio = AudioSegment.from_file(file, format="wav")
        duration = len(audio) / 1000  # Convert milliseconds to seconds

        # Filter intervals that fall within the current audio file
        relevant_markings = [(start, end) for start, end in special_markings if current_position <= start < current_position + duration]

        for start, end in relevant_markings:
            # Extend the window to 20 seconds
            new_start, new_end = extend_window(start, end)

            start_time = max((new_start - current_position) * 1000, 0)  
            # to milliseconds
            end_time = min((new_end - current_position) * 1000, len(audio))  
            # to milliseconds

            # Extract the clip from the audio file
            clip = audio[start_time:end_time]

            # Create the output file path
            output_file_path = os.path.join(output_dir, f"clip_{clip_counter}.wav")
            # Save the clip to a file
            clip.export(output_file_path, format="wav")
            clip_counter += 1

        current_position += duration

# Extract clips
extract_clips(audio_files, special_markings, output_dir)

print("Done: All clips have been saved! Slayyyyy")